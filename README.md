# city-CBS-Astar

This project is part of the TIPE 2023-2024 preparatory course. It implements a Conflict-Based Search
(CBS) algorithm combined with A* for autonomous vehicle path planning in an urban environment. The
project integrates OpenStreetMap (OSM) data to load city maps, displays the map using SFML 2, uses
Reed-Sheep curves to generate smooth trajectories, and constructs a city graph with one edge per road.

## Table of Contents
1. [Overview](#overview)
2. [Features](#features)
3. [Dependencies](#dependencies)
4. [Building and Running the Project](#building-and-running-the-project)
5. [Project Structure](#project-structure)
6. [CMake Configuration](#cmake-configuration)
7. [Documentation](#documentation)
8. [License](#license)
9. [Acknowledgements](#acknowledgements)

## Overview
The goal of this project is to simulate autonomous vehicles navigating through a city environment using
a CBS-based path planning approach. The city is loaded from OSM data, and the map is rendered in real
time using SFML 2. The project uses Reed-Sheep curves to compute smooth paths and builds a graph representing
the city with one edge per road segment.

## Features
- **Autonomous Vehicle Simulation**: Implements path planning for self-driving cars.
- **OSM Integration**: Loads city maps directly from OpenStreetMap data.
- **Graph Construction**: Creates a graph where each edge represents a road.
- **Smooth Trajectories**: Utilizes Reed-Sheep curves for smooth path generation.
- **Visualization**: Renders the city map using SFML 2.
- **Robust Logging**: Uses spdlog for logging purposes.
- **XML Parsing**: Uses tinyxml2 for handling XML data.
- **Flexible Build System**: Managed using CMake with debug and release configurations.

## Dependencies

### Required (must be installed)
- **C++17 Compiler**: GCC, Clang, or MSVC
- **CMake** (3.16 or higher): Build system
- **Python 3**: For the build management script
- **Boost**: Required for various functionalities
- **OMPL** (Open Motion Planning Library): Path planning algorithms

### Auto-fetched by CMake
The following are automatically downloaded during build:
- **SFML 2**: Graphics and window management
- **spdlog**: Logging library
- **tinyxml2**: XML parsing

### Optional
- **Doxygen**: For generating documentation
- **Ninja**: Faster build system (recommended for Windows)

**Installation:** See [INSTALL.md](INSTALL.md) for platform-specific installation instructions.

## Building and Running the Project

The project uses CMake as its build system and includes a cross-platform Python script (`manage.py`) for building, running, and managing the project on Linux, macOS, and Windows.

### Quick Start

**First time setup:** See [INSTALL.md](INSTALL.md) for detailed installation instructions for your platform.

**Build the project:**
```bash
python manage.py build --release
```

**Run the project:**
```bash
python manage.py run -- data [num_agents_min] [num_agents_max] [num_data]
python manage.py run -- run [num_agents]
```

### Using `manage.py` (Recommended)

The Python script works on all platforms:
- `python manage.py build --debug`: Build in debug mode
- `python manage.py build --release`: Build in release mode (optimized)
- `python manage.py run -- [args]`: Run the executable with arguments
- `python manage.py clean`: Clean build artifacts
- `python manage.py doc`: Generate documentation
- `python manage.py sign`: Sign the binary (macOS only)
- `python manage.py help`: Show all available commands

**Examples:**
```bash
# Build in release mode
python manage.py build --release

# Run data generation
python manage.py run -- data 1 10 5

# Run simulation
python manage.py run -- run 5
```

### Using `build.sh` (Legacy, Linux/macOS only)

The legacy shell script is still available for backward compatibility:
```bash
./build.sh release
./build.sh run data 1 10 5
```

### Manual CMake Build

You can also build manually using CMake:
```bash
cmake -DCMAKE_BUILD_TYPE=Release -B build
cmake --build build -j
./build/bin/city-cbs-astar [args]
```

For detailed installation and troubleshooting instructions, see [INSTALL.md](INSTALL.md).

## Project Structure
- **src/**: Contains source files including modules for A*, car dynamics, city graph and map management, constraint control, and more.
  - **managers/**: Contains manager implementations (CBS, OCBS)
  - **dubins/**: Contains Dubins path interpolation
- **include/**: Contains header files with class declarations and configuration
- **python/**: Contains data visualization scripts
- **assets/**: Contains map data (OSM files) and fonts
- **build.sh**: Shell script to build, run, and manage the project
- **CMakeLists.txt**: CMake configuration file
- **doc/**: Contains documentation files generated by Doxygen
- **CODING_STANDARDS.md**: Coding standards and best practices for contributors

### Key Modules
- **AStar** (`aStar.cpp/h`): A* pathfinding algorithm for finding optimal paths
- **ManagerCBS/ManagerOCBS** (`managers/`): Conflict-Based Search implementations for multi-agent planning
- **CityGraph** (`cityGraph.cpp/h`): Graph representation of city streets
- **CityMap** (`cityMap.cpp/h`): OSM map loading and processing
- **Car** (`car.cpp/h`): Vehicle model and dynamics
- **DubinsInterpolator** (`dubins/`): Smooth path generation using Dubins curves

## CMake Configuration
The CMake configuration ensures the following:
- The project uses C++17.
- The target architecture is set to arm64.
- Both debug and release configurations are supported, including memory sanitizers in debug mode.
- External dependencies (SFML, spdlog, tinyxml2) are fetched automatically.
- Boost and OMPL are required and must be found on the system.

## Documentation
The project includes Doxygen support for generating documentation. It's available [here](https://faywyn.github.io/city-CBS-Astar/html/index.html) for
the html version, and the [pdf version](https://faywyn.github.io/city-CBS-Astar/pdf/refman.pdf) is also available.

For developers contributing to the project, please refer to [CODING_STANDARDS.md](CODING_STANDARDS.md) for coding conventions and best practices.

## License
This project is licensed under the MIT License. See the [LICENSE](https://github.com/Faywyn/city-CBS-Astar/blob/main/LICENSE) file for more information.

## Acknowledgements
- [OpenStreetMap](https://www.openstreetmap.org/): For providing city map data.
- [SFML](https://www.sfml-dev.org/): For graphics and window management.
- [Boost](https://www.boost.org/): For various functionalities.
- [OMPL](https://ompl.kavrakilab.org/): For motion planning.
- [spdlog](https://github.com/gabime/spdlog): For logging purposes.
- [tinyxml2](https://github.com/leethomason/tinyxml2): For XML parsing.

## 
https://github.com/user-attachments/assets/7b6f8dc0-6f69-4623-8046-ff09daf381dd
